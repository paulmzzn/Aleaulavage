!function(){"use strict";document.addEventListener("DOMContentLoaded",function(){if(!document.querySelector(".checkout-container"))return;const e=document.querySelector('[data-step="1"]'),t=document.querySelector('[data-step="2"]'),n=document.getElementById("btn-to-step-2"),o=document.getElementById("btn-edit-step-1"),s=document.getElementById("same-billing"),i=document.getElementById("billing-form"),c=(document.querySelectorAll('input[name="payment_method"]'),document.getElementById("card-form"),document.getElementById("lcr-info"),document.getElementById("btn-pay"),document.querySelector('input[name="billing_first_name"]')),d=document.querySelector('input[name="billing_last_name"]'),r=document.querySelector('input[name="billing_company"]'),a=document.querySelector('input[name="billing_siret"]'),l=document.querySelector('input[name="billing_address_1"]'),u=document.querySelector('input[name="billing_postcode"]'),m=document.querySelector('input[name="billing_city"]'),p=[c,d,r,a,l,u,m];p.forEach(e=>{e?.addEventListener("input",function(){this.value.trim()&&this.classList.remove("field-error")})});const y=document.getElementById("summary-address"),h=document.getElementById("summary-billing-note");function v(){const e=(e,t)=>{const n=document.getElementById(e);n&&(n.value=t||"")};if(s?.checked)e("hidden_shipping_first_name",c?.value),e("hidden_shipping_last_name",d?.value),e("hidden_shipping_company",r?.value),e("hidden_shipping_siret",a?.value),e("hidden_shipping_address_1",l?.value),e("hidden_shipping_postcode",u?.value),e("hidden_shipping_city",m?.value);else{e("hidden_shipping_first_name",c?.value),e("hidden_shipping_last_name",d?.value),e("hidden_shipping_company",r?.value),e("hidden_shipping_siret",a?.value);const t=document.getElementById("shipping_address_1_display"),n=document.getElementById("shipping_postcode_display"),o=document.getElementById("shipping_city_display");e("hidden_shipping_address_1",t?.value),e("hidden_shipping_postcode",n?.value),e("hidden_shipping_city",o?.value)}}s?.addEventListener("change",function(){this.checked?i.style.display="none":i.style.display="block",v()}),n?.addEventListener("click",function(){if(!function(e){let t=!0;return e.forEach(e=>{e&&(e.hasAttribute("required")&&!e.value.trim()?(e.classList.add("field-error"),t=!1):(e.hasAttribute("required"),e.classList.remove("field-error")))}),t}(p)){const e=document.querySelector(".field-error");return void(e&&e.focus())}y&&(y.textContent=`${l.value}, ${u.value} ${m.value}`),h&&(h.textContent=s?.checked?"Livraison identique":"Adresse de livraison différente"),v(),e.classList.remove("active"),e.classList.add("completed"),e.querySelector(".step-content").style.display="none",e.querySelector(".step-summary").style.display="flex",e.querySelector(".step-number").textContent="✓",t.classList.add("active");const n=document.getElementById("step2-content");n&&(n.classList.remove("step-hidden"),n.classList.add("step-visible")),document.querySelectorAll(".payment-option").forEach(e=>{e.classList.remove("selected")}),document.querySelectorAll(".gateway-fields").forEach(e=>{e.style.display="none"}),f.forEach(e=>{e.checked=!1}),setTimeout(function(){jQuery(document.body).trigger("update_checkout"),window.dispatchEvent(new Event("resize"))},100)}),document.querySelectorAll(".shipping-field-display").forEach(e=>{e.addEventListener("input",function(){const e=this.getAttribute("data-target"),t=document.getElementById(e);t&&(t.value=this.value)})}),o?.addEventListener("click",function(){e.classList.add("active"),e.classList.remove("completed"),e.querySelector(".step-content").style.display="block",e.querySelector(".step-summary").style.display="none",e.querySelector(".step-number").textContent="1",t.classList.remove("active");const n=document.getElementById("step2-content");n&&(n.classList.add("step-hidden"),n.classList.remove("step-visible"))});const f=document.querySelectorAll('input[name="payment_method"]');function g(e,t,n,o){const s=document.getElementById(e),i=document.getElementById(t),c=document.getElementById(n),d=document.getElementById(o);if(!s||!i)return;let r,a=-1;s.addEventListener("input",function(){const e=this.value.trim();if(clearTimeout(r),e.length<3)return i.classList.remove("active"),void(i.innerHTML="");r=setTimeout(()=>{!async function(e,t,n,o,s){try{const i=await fetch(`https://api-adresse.data.gouv.fr/search/?q=${encodeURIComponent(e)}&limit=5&type=housenumber`),c=await i.json();if(c.features&&c.features.length>0)E(c.features,t,n,o,s);else{const i=await fetch(`https://api-adresse.data.gouv.fr/search/?q=${encodeURIComponent(e)}&limit=5`),c=await i.json();c.features&&c.features.length>0?E(c.features,t,n,o,s):t.classList.remove("active")}}catch(e){console.error("Address API error:",e),t.classList.remove("active")}}(e,i,s,c,d)},300)}),s.addEventListener("keydown",function(e){const t=i.querySelectorAll(".address-suggestion-item");"ArrowDown"===e.key?(e.preventDefault(),a++,a>=t.length&&(a=0),_(t,a)):"ArrowUp"===e.key?(e.preventDefault(),a--,a<0&&(a=t.length-1),_(t,a)):"Enter"===e.key?(e.preventDefault(),a>-1&&t[a]&&t[a].click()):"Escape"===e.key&&(i.classList.remove("active"),a=-1)}),document.addEventListener("click",function(e){s.contains(e.target)||i.contains(e.target)||(i.classList.remove("active"),a=-1)})}function _(e,t){e.forEach((e,n)=>{e.classList.toggle("active",n===t),e.style.background=n===t?"#f1f5f9":""})}function E(e,t,n,o,s){t.innerHTML="",e.forEach(e=>{const i=e.properties,c=document.createElement("div");c.className="address-suggestion-item",c.innerHTML=`\n\t\t\t\t\t<div class="suggestion-main">${i.name||i.label}</div>\n\t\t\t\t\t<div class="suggestion-secondary">${i.postcode} ${i.city}</div>\n\t\t\t\t`,c.addEventListener("click",function(){n.value=i.name||i.housenumber+" "+i.street,o&&(o.value=i.postcode||""),s&&(s.value=i.city||""),n.classList.remove("field-error"),o&&o.classList.remove("field-error"),s&&s.classList.remove("field-error"),t.classList.remove("active")}),t.appendChild(c)}),t.classList.add("active")}f.forEach(e=>{e.addEventListener("change",function(){document.querySelectorAll(".payment-option").forEach(e=>{e.classList.remove("selected")}),this.closest(".payment-option")?.classList.add("selected"),document.querySelectorAll(".gateway-fields").forEach(e=>{e.style.display="none"});const e=document.getElementById("gateway-fields-"+this.value);if(e){e.style.display="block";e.querySelectorAll(".wc-upe-form, .wc-stripe-upe-element, fieldset").forEach(e=>{e.style.display="block",e.style.visibility="visible",e.style.height="auto",e.style.opacity="1"})}})}),g("billing_address_1","billing-address-suggestions","billing_postcode","billing_city"),g("shipping_address_1_display","shipping-address-suggestions","shipping_postcode_display","shipping_city_display")}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("apply-coupon-btn"),t=document.getElementById("sidebar-coupon-code"),n=document.getElementById("coupon-message");e&&t&&e.addEventListener("click",function(){const o=t.value.trim();o&&(e.disabled=!0,e.textContent="...",jQuery.ajax({type:"POST",url:wc_checkout_params.wc_ajax_url.toString().replace("%%endpoint%%","apply_coupon"),data:{security:wc_checkout_params.apply_coupon_nonce,coupon_code:o},success:function(t){if(t&&-1===t.indexOf("woocommerce-error"))n.innerHTML='<span style="color:#5899e2;">Code appliqué !</span>',location.reload();else{let e="Code invalide";try{const n=(new DOMParser).parseFromString(t,"text/html");e=n.querySelector("li")?.textContent||"Code invalide"}catch(e){}n.innerHTML='<span style="color:#ef4444;">'+e+"</span>"}e.disabled=!1,e.textContent="OK"},error:function(){n.innerHTML='<span style="color:#ef4444;">Erreur réseau</span>',e.disabled=!1,e.textContent="OK"}}))})}),document.addEventListener("DOMContentLoaded",function(){function e(){const e=document.getElementById("place_order");if(!e)return;const t=document.querySelector(".order-total .woocommerce-Price-amount, .summary-totals .total .woocommerce-Price-amount, .order-total bdi");if(t){const n=t.textContent.trim();e.textContent="Payer "+n,e.value="Payer "+n}else e.textContent="Payer",e.value="Payer"}e(),jQuery(document.body).on("updated_checkout",function(){e()}),setTimeout(e,500)}),document.addEventListener("DOMContentLoaded",function(){function e(){const e=document.getElementById("payment_method_stripe");if(e&&!e.checked){document.querySelectorAll('input[name="payment_method"]').forEach(e=>{e.checked=!1});document.querySelectorAll(".payment_box").forEach(e=>{e.style.display="none"}),e.checked=!0;const t=document.querySelector(".payment_box.payment_method_stripe");t&&(t.style.display="block"),jQuery(e).trigger("change")}}setTimeout(e,100),jQuery(document.body).on("updated_checkout",function(){setTimeout(e,100)})})}(),document.addEventListener("DOMContentLoaded",function(){const e=document.createElement("div");let t,n;function o(){if(!e.classList.contains("active"))return;const t=document.querySelectorAll("iframe");let n=!1;for(let e=0;e<t.length;e++){const o=t[e],s=o.getAttribute("name")||"",i=o.getAttribute("src")||"";if(s.includes("__privateStripe")&&s.includes("challenge")||i.includes("stripe")&&i.includes("3ds")||s.includes("stripe-challenge-frame")){const e=window.getComputedStyle(o),t=o.getBoundingClientRect();if("none"!==e.display&&"hidden"!==e.visibility&&null!==o.offsetParent&&(t.width>300||t.height>300)){n=!0;break}}}n&&!e.classList.contains("hide-for-3ds")?e.classList.add("hide-for-3ds"):!n&&e.classList.contains("hide-for-3ds")&&e.classList.remove("hide-for-3ds")}function s(){e.classList.remove("active"),t&&clearInterval(t),n&&clearInterval(n)}e.className="checkout-loading-overlay",e.innerHTML='\n            <div class="checkout-loader">\n                <div class="checkout-loader-icon">\n                    <svg class="checkout-loader-lock" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                        <path d="M19 11H5C3.89543 11 3 11.8954 3 13V20C3 21.1046 3.89543 22 5 22H19C20.1046 22 21 21.1046 21 20V13C21 11.8954 20.1046 11 19 11Z" stroke="#5899e2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                        <path d="M7 11V7C7 5.67392 7.52678 4.40215 8.46447 3.46447C9.40215 2.52678 10.6739 2 12 2C13.3261 2 14.5979 2.52678 15.5355 3.46447C16.4732 4.40215 17 5.67392 17 7V11" stroke="#5899e2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                        <circle cx="12" cy="16" r="1.5" fill="#5899e2"/>\n                    </svg>\n                </div>\n                <div class="checkout-loader-text">Paiement en cours</div>\n                <div class="checkout-loader-subtext">Merci de patienter<span class="dots"></span></div>\n                <div class="checkout-loader-progress">\n                    <div class="checkout-loader-progress-bar"></div>\n                </div>\n            </div>\n        ',document.body.appendChild(e);const i=document.querySelector("form.checkout");i&&i.addEventListener("submit",function(s){const i=document.getElementById("place_order");i&&!i.disabled&&(e.classList.add("active"),function(){const n=e.querySelector(".dots");if(!n)return;let o=0;t=setInterval(function(){o=(o+1)%4,n.textContent=".".repeat(o)},500)}(),n&&clearInterval(n),n=setInterval(o,300))}),jQuery(document.body).on("checkout_error",s),jQuery(document).ajaxComplete(function(e,t,n){if(n.url&&-1!==n.url.indexOf("wc-ajax=checkout")){const e=t.responseJSON;e&&("failure"===e.result||e.messages)&&s()}})});